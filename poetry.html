<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Poetry - Between Us</title>

  <style>
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family: 'Georgia', serif;
    }

    body{
      min-height:100vh;
      background: linear-gradient(180deg, #f4d6dc 0%, #e9bfc9 40%, #d9a3a0 75%, #c08b7f 100%);
      color:#2a1416;
      padding-bottom: 50px;
    }

    /* ---------- NAV ---------- */
    .nav{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:18px 32px;
      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(12px);
      border-bottom:1px solid rgba(200,150,150,0.25);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav h1{
      font-size:1.4rem;
      font-weight:normal;
    }

    .nav-links{
      display:flex;
      gap:20px;
    }

    .nav-links a{
      color:#3a1c1f;
      font-size:0.95rem;
      text-decoration:none;
      opacity:0.75;
    }

    .nav-links a:hover{
      opacity:1;
      text-decoration:underline;
    }

    /* ---------- CONTENT ---------- */
    .content{
      max-width:800px;
      margin:auto;
      padding:45px 20px;
    }

    .intro{
      text-align:center;
      margin-bottom:35px;
    }

    .intro h2{
      font-size:1.8rem;
      margin-bottom:10px;
      font-weight:normal;
    }

    /* ---------- POETRY EDITOR ---------- */
    #poetryCard{
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(14px);
      border-radius:20px;
      padding:25px;
      border:1px solid rgba(210,150,150,0.3);
      margin-bottom:40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }

    .author-toggle {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #authorSelect {
      padding: 6px 12px;
      border-radius: 8px;
      border: 1px solid rgba(210,150,150,0.5);
      background: white;
      font-size: 0.9rem;
      outline: none;
      cursor: pointer;
    }

    #poemInput{
      width:100%;
      height:150px;
      border-radius:12px;
      border:1px solid rgba(210,150,150,0.3);
      padding:15px;
      font-size:1rem;
      resize:none;
      background: rgba(255,255,255,0.5);
      outline: none;
      line-height: 1.6;
    }

    #savePoem{
      margin-top:15px;
      padding:12px 25px;
      border-radius:25px;
      border:none;
      background: linear-gradient(135deg, #d78c96, #f0c4a5);
      color:#fff;
      font-weight: bold;
      cursor:pointer;
      transition: opacity 0.2s;
    }

    #savePoem:hover { opacity: 0.9; }

    /* ---------- POEM LIST ---------- */
    .poem-entry {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      position: relative;
      border: 1px solid rgba(210,150,150,0.2);
      box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    }

    .author-badge {
      display: inline-block;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 3px 10px;
      border-radius: 5px;
      margin-bottom: 12px;
      font-weight: bold;
    }

    .badge-him { background: #e2e2e2; color: #555; }
    .badge-her { background: #ffdce3; color: #a35d6a; }

    .poem-text {
      font-size: 1.1rem;
      line-height: 1.7;
      white-space: pre-wrap;
      color: #333;
    }

    .poem-date {
      font-size: 0.8rem;
      color: #999;
      margin-top: 15px;
    }

    .del-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: #ddd;
      cursor: pointer;
      font-size: 1.2rem;
    }

    .del-btn:hover { color: #c77d87; }

    footer{ text-align:center; font-size:0.8rem; opacity:0.6; margin-top: 20px; }
  </style>
</head>
<body>

  <div class="nav">
    <h1>Between Us</h1>
    <div class="nav-links">
      <a href="main.html">Home</a>
      <a href="memories.html">Memories</a>
      <a href="study.html">Study</a>
      <a href="tree.html">Year of Hearts</a>
      <a href="lm.html">Love Meter</a>
    </div>
  </div>

  <div class="content">
    <div class="intro">
      <h2>Our Shared Poems</h2>
      <p>A space for the words we find for each other.</p>
    </div>

    <div id="poetryCard">
      <div class="author-toggle">
        <span>From:</span>
        <select id="authorSelect">
          <option value="Him">Him</option>
          <option value="Her">Her</option>
        </select>
      </div>
      <textarea id="poemInput" placeholder="Write something from the heart..."></textarea>
      <button id="savePoem">Save to Archive</button>
    </div>

    <div id="poemsList"></div>

    <footer>growing gently ðŸŒ±</footer>
  </div>

  <script type="module">
    // 1. MODERN FIREBASE MODULE IMPORTS
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

    // 2. YOUR FIREBASE CONFIGURATION
    const firebaseConfig = {
      apiKey: "AIzaSyAgqdRnE-xxv-fAfUOrxGSbfS1AHGVSvzA",
      authDomain: "betweenus-f0965.firebaseapp.com",
      databaseURL: "https://betweenus-f0965-default-rtdb.firebaseio.com/",
      projectId: "betweenus-f0965",
      storageBucket: "betweenus-f0965.firebasestorage.app",
      messagingSenderId: "1055124580872",
      appId: "1:1055124580872:web:f6dcb2759a5e1bc57abfbd",
      measurementId: "G-P7B1NDX9BL"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const poemsRef = ref(database, 'poems');

    const poemInput = document.getElementById('poemInput');
    const savePoem = document.getElementById('savePoem');
    const poemsList = document.getElementById('poemsList');
    const authorSelect = document.getElementById('authorSelect');

    // 3. RENDER POEMS FROM FIREBASE (Realtime)
    onValue(poemsRef, (snapshot) => {
      const data = snapshot.val();
      poemsList.innerHTML = '';
      
      if (data) {
        const entries = Object.entries(data).sort((a, b) => b[1].timestamp - a[1].timestamp);

        entries.forEach(([id, p]) => {
          const div = document.createElement('div');
          div.className = 'poem-entry';
          const badgeClass = p.author === 'Him' ? 'badge-him' : 'badge-her';
          const date = new Date(p.timestamp).toLocaleDateString(undefined, { 
            month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' 
          });

          div.innerHTML = `
            <span class="author-badge ${badgeClass}">${p.author}</span>
            <button class="del-btn" data-id="${id}">âœ•</button>
            <div class="poem-text">${p.text}</div>
            <div class="poem-date">${date}</div>
          `;

          // Add click event for delete button
          div.querySelector('.del-btn').addEventListener('click', () => {
             if(confirm("Are you sure you want to remove this poem?")) {
                const itemRef = ref(database, 'poems/' + id);
                remove(itemRef);
             }
          });

          poemsList.appendChild(div);
        });
      }
    });

    // 4. SAVE POEM
    savePoem.onclick = () => {
      const text = poemInput.value.trim();
      const author = authorSelect.value;
      
      if (text === '') return;

      push(poemsRef, {
        text: text,
        author: author,
        timestamp: Date.now()
      }).then(() => {
        poemInput.value = '';
      }).catch((error) => {
        console.error("Error saving poem:", error);
        alert("Make sure your Firebase Database rules are set to public!");
      });
    };
  </script>
</body>
</html>